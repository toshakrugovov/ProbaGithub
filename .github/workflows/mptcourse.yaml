name: mptcourse

on:
  push:
    branches: [ master ]

  #pull_request:

jobs:
  validate:
    name: Validate Django project
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v6

      - name: Set up Python
        uses: actions/setup-python@v6
        with:
          python-version: '3.12.3'
        
      - name: Create venv and install lids
        run: |
          python3 -m venv .venv
          source .venv/bin/activate
          pip install --upgrade pip
          pip install -r requirements.txt


      - name: Check django project
        run: |
          source .venv/bin/activate
          echo "Проверка настроек Django"
          python3 manage.py check
          echo "Настройки валидны"

      - name: Check django migrations
        run: |
          source .venv/bin/activate
          echo "Проверка миграций django"
          python3 manage.py makemigrations --check  --dry-run
          echo "Миграции валидны"

    test: 
      name: Test Dgango static file
      runs-on: ubuntu-latest
      needs: validate
      steps:
        - name: Set up Python
          uses: actions/checkout@v6

        - name: Set up Python
          uses: actions/setup-python@v6
          with:
           python-version: '3.12.3'
        
        - name: Create venv and install lids
          run: |
            python3 -m venv .venv
            source .venv/bin/activate
            pip install --upgrade pip
            pip install -r requirements.txt

        - name: Check Django static file
          run: |
            source .venv/bin/activate
            echo "Проверка статик-файлов django"
            python3 manage.py collectstatic --noinput --dry-run
            echo "Статики валидны"

        


