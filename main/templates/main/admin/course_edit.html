{% extends 'base.html' %}
{% load static %}

{% block title %}{% if course %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞{% else %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞{% endif %} ‚Äî –ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/home.css' %}">
<link rel="stylesheet" href="{% static 'css/admin.css' %}">
{% endblock %}

{% block content %}
<div class="form-wrap">
    <h1>{% if course %}–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—É—Ä—Å–∞{% else %}–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–∞{% endif %}</h1>
    <div style="margin-bottom: 16px;">
        <a href="{% url 'admin_courses_list' %}">‚Üê –ù–∞–∑–∞–¥ –∫ —Å–ø–∏—Å–∫—É –∫—É—Ä—Å–æ–≤ (–ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞)</a>
    </div>
    {% if not course %}
    <p style="margin-bottom: 16px; padding: 12px; background: var(--surface, #f5f5f5); border-radius: 8px; font-size: 14px;">
        –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏ –Ω–∞–∂–º–∏—Ç–µ ¬´–°–æ—Ö—Ä–∞–Ω–∏—Ç—å¬ª. –ü–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –æ—Ç–∫—Ä–æ–µ—Ç—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –≥–¥–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫–∏ –∫—É—Ä—Å–∞ (—Å—Ç—Ä–∞–Ω–∏—Ü—ã —Å –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏, –≤–∏–¥–µ–æ –∏–ª–∏ PDF –∏ —Ç–µ–∫—Å—Ç–æ–º).
    </p>
    {% endif %}
    <form method="post" action="{% if course %}{% url 'admin_course_edit' course_id=course.id %}{% else %}{% url 'admin_course_add' %}{% endif %}" class="form-container" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="form-group">
            <label for="title">–ù–∞–∑–≤–∞–Ω–∏–µ *</label>
            <input type="text" id="title" name="title" value="{% if course %}{{ course.title }}{% elif form_data.title %}{{ form_data.title }}{% endif %}" required>
        </div>
        <div class="form-group">
            <label for="slug">Slug (URL)</label>
            <input type="text" id="slug" name="slug" value="{% if course %}{{ course.slug }}{% elif form_data.slug %}{{ form_data.slug }}{% endif %}" placeholder="–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è">
        </div>
        <div class="form-group">
            <label for="category_id">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
            <select id="category_id" name="category_id">
                <option value="">‚Äî</option>
                {% for cat in categories %}
                <option value="{{ cat.id }}" {% if course and course.category_id == cat.id %}selected{% elif form_data.category_id and form_data.category_id|stringformat:"s" == cat.id|stringformat:"s" %}selected{% endif %}>{{ cat.category_name }}</option>
                {% endfor %}
            </select>
        </div>
        <div class="form-group">
            <label for="description">–û–ø–∏—Å–∞–Ω–∏–µ</label>
            <textarea id="description" name="description" rows="4">{% if course %}{{ course.description }}{% elif form_data.description %}{{ form_data.description }}{% endif %}</textarea>
        </div>
        <div class="form-group">
            <label for="included_content">–ß—Ç–æ –≤—Ö–æ–¥–∏—Ç –≤ —Å–æ—Å—Ç–∞–≤</label>
            <textarea id="included_content" name="included_content" rows="3">{% if course %}{{ course.included_content }}{% elif form_data.included_content %}{{ form_data.included_content }}{% endif %}</textarea>
        </div>
        <div class="form-group">
            <label for="price">–¶–µ–Ω–∞ (‚ÇΩ) *</label>
            <input type="number" id="price" name="price" value="{% if course %}{{ course.price }}{% elif form_data.price %}{{ form_data.price }}{% else %}0{% endif %}" min="0" step="0.01" required>
        </div>
        <div class="form-group">
            <label for="discount">–°–∫–∏–¥–∫–∞ (%)</label>
            <input type="number" id="discount" name="discount" value="{% if course %}{{ course.discount }}{% elif form_data.discount %}{{ form_data.discount }}{% else %}0{% endif %}" min="0" max="100" step="0.01">
        </div>
        <div class="form-group">
            <label for="main_photo">–ì–ª–∞–≤–Ω–æ–µ —Ñ–æ—Ç–æ –∫—É—Ä—Å–∞ ‚Äî –∑–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</label>
            <input type="file" id="main_photo" name="main_photo" accept=".jpg,.jpeg,.png,.webp,.gif">
            <p style="margin-top:6px;font-size:13px;color:var(--text-color-secondary);">JPG, PNG, WebP –∏–ª–∏ GIF. –§–∞–π–ª—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –Ω–∞ —Å–µ—Ä–≤–µ—Ä, –≤ –ë–î —Ö—Ä–∞–Ω–∏—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—É—Ç—å.</p>
            {% if course and course.cover_image_path %}<p style="margin-top:8px;font-size:13px;color:var(--text-color-secondary);">–°–µ–π—á–∞—Å: <img src="{{ course.cover_image_path }}" alt="" style="max-height:60px;vertical-align:middle;"> {{ course.cover_image_path }}</p>{% endif %}
            <label for="cover_image_path" style="margin-top:12px;display:block;">–ò–ª–∏ –≤—Å—Ç–∞–≤–∏—Ç—å URL –æ–±–ª–æ–∂–∫–∏</label>
            <input type="text" id="cover_image_path" name="cover_image_path" value="{% if course %}{{ course.cover_image_path }}{% elif form_data.cover_image_path %}{{ form_data.cover_image_path }}{% endif %}" placeholder="/media/... –∏–ª–∏ https://...">
        </div>
        <div class="form-group">
            <label>
                <input type="checkbox" name="is_available" {% if not course or course.is_available %}checked{% endif %}{% if form_data.is_available and not course %} checked{% endif %}>
                –î–æ—Å—Ç—É–ø–µ–Ω –¥–ª—è –ø–æ–∫—É–ø–∫–∏
            </label>
        </div>

        {% if course %}
        <div class="form-group" style="margin-top: 32px; padding-top: 24px; border-top: 1px solid var(--border-color);">
            <h2 style="font-size: 18px; margin-bottom: 12px;">–£—Ä–æ–∫–∏ –∫—É—Ä—Å–∞</h2>
            <p style="font-size: 14px; color: var(--text-color-secondary); margin-bottom: 16px;">–£ –∫–∞–∂–¥–æ–≥–æ —É—Ä–æ–∫–∞ ‚Äî –¥–æ 10 —Å—Ç—Ä–∞–Ω–∏—Ü (–∫–∞—Ä—Ç–∏–Ω–∫–∞, –≤–∏–¥–µ–æ –∏–ª–∏ PDF + —Ç–µ–∫—Å—Ç). –£—á–µ–Ω–∏–∫ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —É—Ä–æ–∫, –ª–∏—Å—Ç–∞–µ—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞–∂–∏–º–∞–µ—Ç ¬´–Ø —É—Å–≤–æ–∏–ª¬ª –∏ —Å—Ç–∞–≤–∏—Ç üëç/üëé.</p>
            <div style="margin-bottom: 20px;">
                {% for les in course.lessons.all %}
                <div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid var(--border-color);">
                    <span style="font-weight:600;">–£—Ä–æ–∫ {{ forloop.counter }}</span>
                    <span style="color:var(--text-color-secondary);">{{ les.title|default:"‚Äî" }}</span>
                    <span style="color:var(--text-color-secondary);font-size:13px;">{{ les.pages.count }} —Å—Ç—Ä.</span>
                    <a href="{% url 'admin_lesson_edit' course_id=course.id lesson_id=les.id %}" class="btn" style="margin-left:auto;">–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å</a>
                </div>
                {% empty %}
                <p style="color:var(--text-color-secondary);">–£—Ä–æ–∫–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç.</p>
                {% endfor %}
            </div>
            <a href="{% url 'admin_lesson_add' course_id=course.id %}" class="btn btn-primary">{% if course.lessons.exists %}–î–æ–±–∞–≤–∏—Ç—å —É—Ä–æ–∫{% else %}–î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–≤—ã–π —É—Ä–æ–∫{% endif %}</a>
        </div>
        {% endif %}

        <div class="form-actions">
            <button type="submit">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
            <a href="{% url 'admin_courses_list' %}">–û—Ç–º–µ–Ω–∞</a>
        </div>
    </form>
</div>

{% endblock %}
